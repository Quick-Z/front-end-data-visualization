import{_ as j,ag as g,ah as M,ai as F,B as A}from"./ol.088d4eef.js";import{e as E,c as U,b as G,d as K,a as b}from"./TileImage.2b84d652.js";import{j as k}from"./net.bced231e.js";var B=function(){var n=function(r,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])},n(r,e)};return function(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}}();function C(n){var r=n[0],e=new Array(r),t=1<<r-1,i,a;for(i=0;i<r;++i)a=48,n[1]&t&&(a+=1),n[2]&t&&(a+=2),e[i]=String.fromCharCode(a),t>>=1;return e.join("")}var D='<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html" target="_blank">Terms of Use</a>',q=function(n){B(r,n);function r(e){var t=this,i=e.hidpi!==void 0?e.hidpi:!1;t=n.call(this,{cacheSize:e.cacheSize,crossOrigin:"anonymous",imageSmoothing:e.imageSmoothing,opaque:!0,projection:j("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:g.LOADING,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:i?2:1,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection})||this,t.hidpi_=i,t.culture_=e.culture!==void 0?e.culture:"en-us",t.maxZoom_=e.maxZoom!==void 0?e.maxZoom:-1,t.apiKey_=e.key,t.imagerySet_=e.imagerySet;var a="https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+t.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+t.apiKey_+"&c="+t.culture_;return k(a,t.handleImageryMetadataResponse.bind(t),void 0,"jsonp"),t}return r.prototype.getApiKey=function(){return this.apiKey_},r.prototype.getImagerySet=function(){return this.imagerySet_},r.prototype.handleImageryMetadataResponse=function(e){if(e.statusCode!=200||e.statusDescription!="OK"||e.authenticationResultCode!="ValidCredentials"||e.resourceSets.length!=1||e.resourceSets[0].resources.length!=1){this.setState(g.ERROR);return}var t=e.resourceSets[0].resources[0],i=this.maxZoom_==-1?t.zoomMax:this.maxZoom_,a=this.getProjection(),x=E(a),l=this.hidpi_?2:1,T=t.imageWidth==t.imageHeight?t.imageWidth/l:[t.imageWidth/l,t.imageHeight/l],z=U({extent:x,minZoom:t.zoomMin,maxZoom:i,tileSize:T});this.tileGrid=z;var w=this.culture_,O=this.hidpi_;if(this.tileUrlFunction=G(t.imageUrlSubdomains.map(function(c){var s=[0,0,0],m=t.imageUrl.replace("{subdomain}",c).replace("{culture}",w);return function(o,v,p){if(o){K(o[0],o[1],o[2],s);var u=m;return O&&(u+="&dpi=d1&device=mobile"),u.replace("{quadkey}",C(s))}else return}})),t.imageryProviders){var P=M(j("EPSG:4326"),this.getProjection());this.setAttributions(function(c){var s=[],m=c.viewState,o=this.getTileGrid(),v=o.getZForResolution(m.resolution,this.zDirection),p=o.getTileCoordForCoordAndZ(m.center,v),u=p[0];return t.imageryProviders.map(function(y){for(var _=!1,S=y.coverageAreas,h=0,R=S.length;h<R;++h){var f=S[h];if(u>=f.zoomMin&&u<=f.zoomMax){var d=f.bbox,Z=[d[1],d[0],d[3],d[2]],I=F(Z,P);if(A(I,c.extent)){_=!0;break}}}_&&s.push(y.attribution)}),s.push(D),s}.bind(this))}this.setState(g.READY)},r}(b),H=q;export{H as B};
